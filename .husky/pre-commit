#!/bin/sh

echo "üîç Running pre-commit checks..."

# ‚ùå Block .env files
STAGED_ENV_FILES=$(git diff --cached --name-only | grep -E '\.env$' || true)

if [ -n "$STAGED_ENV_FILES" ]; then
  echo "‚ùå ERROR: .env files must not be committed:"
  echo "$STAGED_ENV_FILES"
  exit 1
fi

# ‚ùå Block .log files
STAGED_LOG_FILES=$(git diff --cached --name-only | grep -E '\.log$' || true)

if [ -n "$STAGED_LOG_FILES" ]; then
  echo "‚ùå ERROR: .log files must not be committed:"
  echo "$STAGED_LOG_FILES"
  exit 1
fi

# ‚úÖ Prettier check (staged JS only)
STAGED_JS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.js$' || true)

if [ -n "$STAGED_JS_FILES" ]; then
  echo "üé® Checking JS formatting..."
  npx prettier --check $STAGED_JS_FILES
  if [ $? -ne 0 ]; then
    echo "‚ùå ERROR: JavaScript files are not formatted."
    exit 1
  fi
fi

echo "‚úÖ Pre-commit checks passed"
exit 0
